<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Main App</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .btn-group-vertical .btn {
            margin-bottom: 10px;
        }

        #imagePreview {
            max-height: 300px;
            width: auto;
        }
    </style>
</head>

<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-3">
                <div class="btn-group-vertical">
                    <button type="button" class="btn btn-primary" id="uploadBtn">Upload Image</button>
                    <button type="button" class="btn btn-primary" id="predictBtn">Predict & Show Result</button>
                    <button type="button" class="btn btn-primary" id="logoutBtn">Logout</button>
                </div>
            </div>
            <div class="col-md-9">
                <div class="card">
                    <div class="card-header">
                        Image Preview
                    </div>
                    <div class="card-body">
                        <img src="https://via.placeholder.com/300" alt="Image Preview" id="imagePreview"
                            class="img-fluid">
                    </div>
                </div>
                <div class="mt-3" id="predictionResult"></div>
            </div>
        </div>
    </div>
    <script>
        // JavaScript code for handling image upload and prediction
        const uploadBtn = document.getElementById('uploadBtn');
        const imagePreview = document.getElementById('imagePreview');
        const predictBtn = document.getElementById('predictBtn');
        const predictionResult = document.getElementById('predictionResult');

        uploadBtn.addEventListener('click', () => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = () => {
                const file = input.files[0];
                const reader = new FileReader();
                reader.onload = () => {
                    imagePreview.src = reader.result;
                    const base64Image = reader.result.split(',')[1];
                    predictBtn.dataset.image = base64Image;
                };
                console.log(file);
                reader.readAsDataURL(file);
            };
            input.click();
        });

        predictBtn.addEventListener('click', () => {
            const base64Image = predictBtn.dataset.image;
            if (!base64Image) {
                alert('Please upload an image first.');
                return;
            }
            const formData = new FormData();
            formData.append('image', imagePreview.src);

            fetch('/predict', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ image: base64Image }),
            })
                .then(response => response.json())
                .then(data => {
                    // Display the prediction result below the image preview
                    predictionResult.innerHTML = `<strong>Prediction:</strong> ${data.prediction}`;
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        });
    </script>
</body>

</html>